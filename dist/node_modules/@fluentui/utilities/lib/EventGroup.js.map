{"version":3,"file":"EventGroup.js","sources":["../../../../../node_modules/@fluentui/utilities/lib/EventGroup.js"],"sourcesContent":["import { getDocument } from './dom';\nimport { assign } from './object';\n/** An instance of EventGroup allows anything with a handle to it to trigger events on it.\n *  If the target is an HTMLElement, the event will be attached to the element and can be\n *  triggered as usual (like clicking for onClick).\n *  The event can be triggered by calling EventGroup.raise() here. If the target is an\n *  HTMLElement, the event gets raised and is handled by the browser. Otherwise, it gets\n *  handled here in EventGroup, and the handler is called in the context of the parent\n *  (which is passed in in the constructor).\n *\n * @public\n * {@docCategory EventGroup}\n */\nexport var EventGroup = /** @class */ (function () {\n    /** parent: the context in which events attached to non-HTMLElements are called */\n    function EventGroup(parent) {\n        this._id = EventGroup._uniqueId++;\n        this._parent = parent;\n        this._eventRecords = [];\n    }\n    /** For IE8, bubbleEvent is ignored here and must be dealt with by the handler.\n     *  Events raised here by default have bubbling set to false and cancelable set to true.\n     *  This applies also to built-in events being raised manually here on HTMLElements,\n     *  which may lead to unexpected behavior if it differs from the defaults.\n     *\n     */\n    EventGroup.raise = function (target, eventName, eventArgs, bubbleEvent, doc) {\n        var retVal;\n        var theDoc = doc !== null && doc !== void 0 ? doc : getDocument();\n        if (EventGroup._isElement(target)) {\n            if (typeof theDoc !== 'undefined' && theDoc.createEvent) {\n                var ev = theDoc.createEvent('HTMLEvents');\n                // eslint-disable-next-line deprecation/deprecation\n                ev.initEvent(eventName, bubbleEvent || false, true);\n                assign(ev, eventArgs);\n                retVal = target.dispatchEvent(ev);\n            }\n            else if (typeof theDoc !== 'undefined' && theDoc.createEventObject) {\n                // IE8\n                var evObj = theDoc.createEventObject(eventArgs);\n                // cannot set cancelBubble on evObj, fireEvent will overwrite it\n                target.fireEvent('on' + eventName, evObj);\n            }\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore  -- FIXME: strictBindCallApply error - https://github.com/microsoft/fluentui/issues/17331\n            while (target && retVal !== false) {\n                var events = target.__events__;\n                var eventRecords = events ? events[eventName] : null;\n                if (eventRecords) {\n                    for (var id in eventRecords) {\n                        if (eventRecords.hasOwnProperty(id)) {\n                            var eventRecordList = eventRecords[id];\n                            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                            // @ts-ignore  -- FIXME: strictBindCallApply error - https://github.com/microsoft/fluentui/issues/17331\n                            for (var listIndex = 0; retVal !== false && listIndex < eventRecordList.length; listIndex++) {\n                                var record = eventRecordList[listIndex];\n                                if (record.objectCallback) {\n                                    retVal = record.objectCallback.call(record.parent, eventArgs);\n                                }\n                            }\n                        }\n                    }\n                }\n                // If the target has a parent, bubble the event up.\n                target = bubbleEvent ? target.parent : null;\n            }\n        }\n        return retVal;\n    };\n    EventGroup.isObserved = function (target, eventName) {\n        var events = target && target.__events__;\n        return !!events && !!events[eventName];\n    };\n    /** Check to see if the target has declared support of the given event. */\n    EventGroup.isDeclared = function (target, eventName) {\n        var declaredEvents = target && target.__declaredEvents;\n        return !!declaredEvents && !!declaredEvents[eventName];\n    };\n    EventGroup.stopPropagation = function (event) {\n        if (event.stopPropagation) {\n            event.stopPropagation();\n        }\n        else {\n            // IE8\n            event.cancelBubble = true;\n        }\n    };\n    EventGroup._isElement = function (target) {\n        return (!!target && (!!target.addEventListener || (typeof HTMLElement !== 'undefined' && target instanceof HTMLElement)));\n    };\n    EventGroup.prototype.dispose = function () {\n        if (!this._isDisposed) {\n            this._isDisposed = true;\n            this.off();\n            this._parent = null;\n        }\n    };\n    /** On the target, attach a set of events, where the events object is a name to function mapping. */\n    EventGroup.prototype.onAll = function (target, events, useCapture) {\n        for (var eventName in events) {\n            if (events.hasOwnProperty(eventName)) {\n                this.on(target, eventName, events[eventName], useCapture);\n            }\n        }\n    };\n    /**\n     * On the target, attach an event whose handler will be called in the context of the parent\n     * of this instance of EventGroup.\n     */\n    EventGroup.prototype.on = function (target, eventName, callback, options) {\n        var _this = this;\n        if (eventName.indexOf(',') > -1) {\n            var events = eventName.split(/[ ,]+/);\n            for (var i = 0; i < events.length; i++) {\n                this.on(target, events[i], callback, options);\n            }\n        }\n        else {\n            var parent_1 = this._parent;\n            var eventRecord = {\n                target: target,\n                eventName: eventName,\n                parent: parent_1,\n                callback: callback,\n                options: options,\n            };\n            // Initialize and wire up the record on the target, so that it can call the callback if the event fires.\n            var events = (target.__events__ = target.__events__ || {});\n            events[eventName] =\n                events[eventName] ||\n                    {\n                        count: 0,\n                    };\n            events[eventName][this._id] = events[eventName][this._id] || [];\n            events[eventName][this._id].push(eventRecord);\n            events[eventName].count++;\n            if (EventGroup._isElement(target)) {\n                var processElementEvent = function () {\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    if (_this._isDisposed) {\n                        return;\n                    }\n                    var result;\n                    try {\n                        result = callback.apply(parent_1, args);\n                        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                        // @ts-ignore  -- FIXME: strictBindCallApply error - https://github.com/microsoft/fluentui/issues/17331\n                        if (result === false && args[0]) {\n                            var e = args[0];\n                            if (e.preventDefault) {\n                                e.preventDefault();\n                            }\n                            if (e.stopPropagation) {\n                                e.stopPropagation();\n                            }\n                            e.cancelBubble = true;\n                        }\n                    }\n                    catch (e) {\n                        // ignore\n                    }\n                    return result;\n                };\n                eventRecord.elementCallback = processElementEvent;\n                if (target.addEventListener) {\n                    target.addEventListener(eventName, processElementEvent, options);\n                }\n                else if (target.attachEvent) {\n                    // IE8\n                    target.attachEvent('on' + eventName, processElementEvent);\n                }\n            }\n            else {\n                var processObjectEvent = function () {\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    if (_this._isDisposed) {\n                        return;\n                    }\n                    return callback.apply(parent_1, args);\n                };\n                eventRecord.objectCallback = processObjectEvent;\n            }\n            // Remember the record locally, so that it can be removed.\n            this._eventRecords.push(eventRecord);\n        }\n    };\n    EventGroup.prototype.off = function (target, eventName, callback, options) {\n        for (var i = 0; i < this._eventRecords.length; i++) {\n            var eventRecord = this._eventRecords[i];\n            if ((!target || target === eventRecord.target) &&\n                (!eventName || eventName === eventRecord.eventName) &&\n                (!callback || callback === eventRecord.callback) &&\n                (typeof options !== 'boolean' || options === eventRecord.options)) {\n                var events = eventRecord.target.__events__;\n                var targetArrayLookup = events[eventRecord.eventName];\n                var targetArray = targetArrayLookup ? targetArrayLookup[this._id] : null;\n                // We may have already target's entries, so check for null.\n                if (targetArray) {\n                    if (targetArray.length === 1 || !callback) {\n                        targetArrayLookup.count -= targetArray.length;\n                        delete events[eventRecord.eventName][this._id];\n                    }\n                    else {\n                        targetArrayLookup.count--;\n                        targetArray.splice(targetArray.indexOf(eventRecord), 1);\n                    }\n                    if (!targetArrayLookup.count) {\n                        delete events[eventRecord.eventName];\n                    }\n                }\n                if (eventRecord.elementCallback) {\n                    if (eventRecord.target.removeEventListener) {\n                        eventRecord.target.removeEventListener(eventRecord.eventName, eventRecord.elementCallback, eventRecord.options);\n                    }\n                    else if (eventRecord.target.detachEvent) {\n                        // IE8\n                        eventRecord.target.detachEvent('on' + eventRecord.eventName, eventRecord.elementCallback);\n                    }\n                }\n                this._eventRecords.splice(i--, 1);\n            }\n        }\n    };\n    /** Trigger the given event in the context of this instance of EventGroup. */\n    EventGroup.prototype.raise = function (eventName, eventArgs, bubbleEvent) {\n        return EventGroup.raise(this._parent, eventName, eventArgs, bubbleEvent);\n    };\n    /** Declare an event as being supported by this instance of EventGroup. */\n    EventGroup.prototype.declare = function (event) {\n        var declaredEvents = (this._parent.__declaredEvents = this._parent.__declaredEvents || {});\n        if (typeof event === 'string') {\n            declaredEvents[event] = true;\n        }\n        else {\n            for (var i = 0; i < event.length; i++) {\n                declaredEvents[event[i]] = true;\n            }\n        }\n    };\n    EventGroup._uniqueId = 0;\n    return EventGroup;\n}());\n//# sourceMappingURL=EventGroup.js.map"],"names":["EventGroup","parent","target","eventName","eventArgs","bubbleEvent","doc","retVal","theDoc","getDocument","ev","assign","evObj","events","eventRecords","id","eventRecordList","listIndex","record","declaredEvents","event","useCapture","callback","options","_this","i","parent_1","eventRecord","processElementEvent","args","_i","result","e","processObjectEvent","targetArrayLookup","targetArray"],"mappings":"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","x_google_ignoreList":[0]}