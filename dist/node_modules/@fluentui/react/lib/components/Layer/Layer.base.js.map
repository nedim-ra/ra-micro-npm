{"version":3,"file":"Layer.base.js","sources":["../../../../../../../node_modules/@fluentui/react/lib/components/Layer/Layer.base.js"],"sourcesContent":["import { __assign } from \"tslib\";\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore \"react-portal-compat-context\" uses v9 configs via path aliases\nimport { usePortalCompat } from '@fluentui/react-portal-compat-context';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { Fabric } from '../../Fabric';\nimport { classNamesFunction, css, getDocument, setPortalAttribute, setVirtualParent, FocusRectsProvider, FocusRectsContext, IsFocusVisibleClassName, } from '../../Utilities';\nimport { registerLayer, getDefaultTarget, unregisterLayer, getLayerHost, createDefaultLayerHost, } from './Layer.notification';\nimport { useIsomorphicLayoutEffect, useMergedRefs, useWarnings } from '@fluentui/react-hooks';\nvar getClassNames = classNamesFunction();\nvar getFocusVisibility = function (providerRef) {\n    if (providerRef === null || providerRef === void 0 ? void 0 : providerRef.current) {\n        return providerRef.current.classList.contains(IsFocusVisibleClassName);\n    }\n    return false;\n};\nexport var LayerBase = React.forwardRef(function (props, ref) {\n    var registerPortalEl = usePortalCompat();\n    var rootRef = React.useRef(null);\n    var mergedRef = useMergedRefs(rootRef, ref);\n    var layerRef = React.useRef();\n    var fabricElementRef = React.useRef(null);\n    var focusContext = React.useContext(FocusRectsContext);\n    // Tracks if the layer mount events need to be raised.\n    // Required to allow the DOM to render after the layer element is added.\n    var _a = React.useState(false), needRaiseLayerMount = _a[0], setNeedRaiseLayerMount = _a[1];\n    // Sets the focus visible className when the FocusRectsProvider for the layer is rendered\n    // This allows the current focus visibility style to be carried over to the layer content\n    var focusRectsRef = React.useCallback(function (el) {\n        var isFocusVisible = getFocusVisibility(focusContext === null || focusContext === void 0 ? void 0 : focusContext.providerRef);\n        if (el && isFocusVisible) {\n            el.classList.add(IsFocusVisibleClassName);\n        }\n    }, [focusContext]);\n    var children = props.children, className = props.className, eventBubblingEnabled = props.eventBubblingEnabled, fabricProps = props.fabricProps, hostId = props.hostId, insertFirst = props.insertFirst, _b = props.onLayerDidMount, onLayerDidMount = _b === void 0 ? function () { return undefined; } : _b, \n    // eslint-disable-next-line deprecation/deprecation\n    _c = props.onLayerMounted, \n    // eslint-disable-next-line deprecation/deprecation\n    onLayerMounted = _c === void 0 ? function () { return undefined; } : _c, onLayerWillUnmount = props.onLayerWillUnmount, styles = props.styles, theme = props.theme;\n    var fabricRef = useMergedRefs(fabricElementRef, fabricProps === null || fabricProps === void 0 ? void 0 : fabricProps.ref, focusRectsRef);\n    var classNames = getClassNames(styles, {\n        theme: theme,\n        className: className,\n        isNotHost: !hostId,\n    });\n    // Returns the user provided hostId props element, the default target selector,\n    // or undefined if document doesn't exist.\n    var getHost = function (doc, shadowRoot) {\n        var _a, _b;\n        if (shadowRoot === void 0) { shadowRoot = null; }\n        var root = shadowRoot !== null && shadowRoot !== void 0 ? shadowRoot : doc;\n        if (hostId) {\n            var layerHost = getLayerHost(hostId);\n            if (layerHost) {\n                return (_a = layerHost.rootRef.current) !== null && _a !== void 0 ? _a : null;\n            }\n            return (_b = root.getElementById(hostId)) !== null && _b !== void 0 ? _b : null;\n        }\n        else {\n            var defaultHostSelector = getDefaultTarget();\n            // Find the host.\n            var host = defaultHostSelector ? root.querySelector(defaultHostSelector) : null;\n            // If no host is available, create a container for injecting layers in.\n            // Having a container scopes layout computation.\n            if (!host) {\n                host = createDefaultLayerHost(doc, shadowRoot);\n            }\n            return host;\n        }\n    };\n    // Removes the current layer element's parentNode and runs onLayerWillUnmount prop if provided.\n    var removeLayerElement = function () {\n        onLayerWillUnmount === null || onLayerWillUnmount === void 0 ? void 0 : onLayerWillUnmount();\n        var elem = layerRef.current;\n        // Clear ref before removing from the DOM\n        layerRef.current = undefined;\n        if (elem && elem.parentNode) {\n            elem.parentNode.removeChild(elem);\n        }\n    };\n    // If a doc or host exists, it will remove and update layer parentNodes.\n    var createLayerElement = function () {\n        var _a, _b, _c, _d;\n        var doc = getDocument(rootRef.current);\n        var shadowRoot = ((_b = (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.getRootNode()) === null || _b === void 0 ? void 0 : _b.host)\n            ? (_c = rootRef === null || rootRef === void 0 ? void 0 : rootRef.current) === null || _c === void 0 ? void 0 : _c.getRootNode()\n            : undefined;\n        if (!doc || (!doc && !shadowRoot)) {\n            return;\n        }\n        var host = getHost(doc, shadowRoot);\n        if (!host) {\n            return;\n        }\n        // Tabster in V9 sets aria-hidden on the elements outside of the modal dialog. And it doesn't set aria-hidden\n        // on the virtual children of the dialog. But the host element itself is not a virtual child of a dialog, it\n        // might contain virtual children. noDirectAriaHidden flag makes Tabster to poke inside the element and set\n        // aria-hidden on the children (if they are not virtual children of the active V9 dialog) not on the host element.\n        // To avoid importing Tabster as a dependency here, we just set a flag on the host element which is checked by\n        // Tabster.\n        if (!host.__tabsterElementFlags) {\n            host.__tabsterElementFlags = {};\n        }\n        host.__tabsterElementFlags.noDirectAriaHidden = true;\n        // Remove and re-create any previous existing layer elements.\n        removeLayerElement();\n        var el = ((_d = host.ownerDocument) !== null && _d !== void 0 ? _d : doc).createElement('div');\n        el.className = classNames.root;\n        setPortalAttribute(el);\n        setVirtualParent(el, rootRef.current);\n        insertFirst ? host.insertBefore(el, host.firstChild) : host.appendChild(el);\n        layerRef.current = el;\n        setNeedRaiseLayerMount(true);\n    };\n    useIsomorphicLayoutEffect(function () {\n        createLayerElement();\n        // Check if the user provided a hostId prop and register the layer with the ID.\n        if (hostId) {\n            registerLayer(hostId, createLayerElement);\n        }\n        var unregisterPortalEl = layerRef.current ? registerPortalEl(layerRef.current) : undefined;\n        return function () {\n            if (unregisterPortalEl) {\n                unregisterPortalEl();\n            }\n            removeLayerElement();\n            if (hostId) {\n                unregisterLayer(hostId, createLayerElement);\n            }\n        };\n        // eslint-disable-next-line react-hooks/exhaustive-deps -- should run if the hostId updates.\n    }, [hostId]);\n    React.useEffect(function () {\n        if (layerRef.current && needRaiseLayerMount) {\n            onLayerMounted === null || onLayerMounted === void 0 ? void 0 : onLayerMounted();\n            onLayerDidMount === null || onLayerDidMount === void 0 ? void 0 : onLayerDidMount();\n            setNeedRaiseLayerMount(false);\n        }\n    }, [needRaiseLayerMount, onLayerMounted, onLayerDidMount]);\n    useDebugWarnings(props);\n    return (React.createElement(\"span\", { className: \"ms-layer\", ref: mergedRef }, layerRef.current &&\n        ReactDOM.createPortal(React.createElement(FocusRectsProvider, { layerRoot: true, providerRef: fabricRef },\n            React.createElement(Fabric, __assign({}, (!eventBubblingEnabled && getFilteredEvents()), fabricProps, { className: css(classNames.content, fabricProps === null || fabricProps === void 0 ? void 0 : fabricProps.className), ref: fabricRef }), children)), layerRef.current)));\n});\nLayerBase.displayName = 'LayerBase';\nvar filteredEventProps;\nvar onFilterEvent = function (ev) {\n    // We should just be able to check ev.bubble here and only stop events that are bubbling up. However, even though\n    // mouseenter and mouseleave do NOT bubble up, they are showing up as bubbling. Therefore we stop events based on\n    // event name rather than ev.bubble.\n    if (ev.eventPhase === Event.BUBBLING_PHASE &&\n        ev.type !== 'mouseenter' &&\n        ev.type !== 'mouseleave' &&\n        ev.type !== 'touchstart' &&\n        ev.type !== 'touchend') {\n        ev.stopPropagation();\n    }\n};\nfunction getFilteredEvents() {\n    if (!filteredEventProps) {\n        filteredEventProps = {};\n        [\n            'onClick',\n            'onContextMenu',\n            'onDoubleClick',\n            'onDrag',\n            'onDragEnd',\n            'onDragEnter',\n            'onDragExit',\n            'onDragLeave',\n            'onDragOver',\n            'onDragStart',\n            'onDrop',\n            'onMouseDown',\n            'onMouseEnter',\n            'onMouseLeave',\n            'onMouseMove',\n            'onMouseOver',\n            'onMouseOut',\n            'onMouseUp',\n            'onTouchMove',\n            'onTouchStart',\n            'onTouchCancel',\n            'onTouchEnd',\n            'onKeyDown',\n            'onKeyPress',\n            'onKeyUp',\n            'onFocus',\n            'onBlur',\n            'onChange',\n            'onInput',\n            'onInvalid',\n            'onSubmit',\n        ].forEach(function (name) { return (filteredEventProps[name] = onFilterEvent); });\n    }\n    return filteredEventProps;\n}\nfunction useDebugWarnings(props) {\n    if (process.env.NODE_ENV !== 'production') {\n        // eslint-disable-next-line react-hooks/rules-of-hooks -- build-time conditional\n        useWarnings({\n            name: 'Layer',\n            props: props,\n            deprecations: { onLayerMounted: 'onLayerDidMount' },\n        });\n    }\n}\n//# sourceMappingURL=Layer.base.js.map"],"names":["getClassNames","classNamesFunction","getFocusVisibility","providerRef","IsFocusVisibleClassName","LayerBase","React","props","ref","registerPortalEl","usePortalCompat","rootRef","mergedRef","useMergedRefs","layerRef","fabricElementRef","focusContext","FocusRectsContext","_a","needRaiseLayerMount","setNeedRaiseLayerMount","focusRectsRef","el","isFocusVisible","children","className","eventBubblingEnabled","fabricProps","hostId","insertFirst","_b","onLayerDidMount","_c","onLayerMounted","onLayerWillUnmount","styles","theme","fabricRef","classNames","getHost","doc","shadowRoot","root","layerHost","getLayerHost","defaultHostSelector","getDefaultTarget","host","createDefaultLayerHost","removeLayerElement","elem","createLayerElement","_d","getDocument","setPortalAttribute","setVirtualParent","useIsomorphicLayoutEffect","registerLayer","unregisterPortalEl","unregisterLayer","useDebugWarnings","ReactDOM","FocusRectsProvider","Fabric","__assign","getFilteredEvents","css","filteredEventProps","onFilterEvent","ev","name","useWarnings"],"mappings":"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","x_google_ignoreList":[0]}